{% extends 'base.html' %}
{% load static %}
{% block title %}Shopping Cart - Kid Toy Store{% endblock %}

{% block body %}

<div class="cart-container">
  <div class="cart-left">
    <h2 class="section-title">üõí Your Shopping Cart</h2>

    <div class="cart-items">
      {% for cart in carts %}
      <form action="{% url 'remove_cart_item' cart.id %}" method="POST"> {% csrf_token %}
      <div class="cart-item" data-price="{{ cart.item.price }}">
        <div class="cart-item-img">
          <img src="{{ cart.item.image.url }}" class="cart-image" alt="{{ cart.item.name }}">
        </div>
        <div class="cart-item-details">
          <h3>{{ cart.item.name }}</h3>
          <p>{{ cart.item.description }}</p>

          <div class="quantity">
            <button type="button" class="quantity-btn quantity-minus">-</button>
            <input
              type="number"
              class="quantity-input"
              value="{{ cart.quantity }}"
              min="1"
              max="10"
              name="quantity"
            />
            <button type="button" class="quantity-btn quantity-plus">+</button>
          </div>

          <strong class="item-price">Price: $<strong>{{ cart.item.price }}</strong></strong>
        </div>

        <form action="{% url 'remove_cart_item' cart.id %}" method="POST">
          {% csrf_token %}
           <button class="remove-btn">Remove</button>
        </form>

      </div>
      </form>
      {% endfor %}
    </div>

    <div class="order-action">
      <p>You want to buy these products? Then click:</p>
      <button id="orderBtn" class="order-btn">OK</button>
    </div>

    <div style="text-align:center; margin:2rem 0;">
      <a href="{% url 'shop' %}" class="continue-shopping">‚Üê Continue Shopping</a>
    </div>
  </div>

  <!-- Right: Order Summary -->
  <div class="cart-summary">
    <h2>üí≥ Order Summary</h2>
    <div class="summary-row">
      <span>Subtotal:</span>
      <span id="subtotal">$0.00</span>
    </div>
    <div class="summary-row">
      <span>Shipping:</span>
      <span id="shipping">FREE</span>
    </div>
    <div class="summary-row">
      <span>Tax (8%):</span>
      <span id="tax">$0.00</span>
    </div>
    <div class="summary-row">
      <span>Discount:</span>
      <span id="discount" style="color:#4CAF50;">-$0.00</span>
    </div>
    <div class="summary-row total">
      <span>Total:</span>
      <span id="grand-total">$0.00</span>
    </div>
    <button class="btn checkout-btn">üéÅ Proceed to Checkout</button>

    <p
      style="text-align:center;margin-top:1rem;color:#666;font-size:0.9rem;"
    >
      ‚úÖ Safe & Secure Payment<br />
      üöö Free Shipping on Orders Over $50
    </p>
  </div>
</div>

<!-- === JS === -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const items = document.querySelectorAll(".cart-item");
  const orderBtn = document.getElementById("orderBtn");

  // Quantity buttons
  items.forEach((item) => {
    const minus = item.querySelector(".quantity-minus");
    const plus = item.querySelector(".quantity-plus");
    const input = item.querySelector(".quantity-input");
    const price = parseFloat(item.dataset.price);
    const totalDisplay = item.querySelector(".item-total span");

    function updateItemTotal() {
      const qty = parseInt(input.value);
      totalDisplay.textContent = (price * qty).toFixed(2);
    }

    plus.addEventListener("click", () => {
      let val = parseInt(input.value);
      if (val < 10) {
        input.value = val + 1;
        updateItemTotal();
      }
    });

    minus.addEventListener("click", () => {
      let val = parseInt(input.value);
      if (val > 1) {
        input.value = val - 1;
        updateItemTotal();
      }
    });

    input.addEventListener("change", updateItemTotal);
  });

  // OK button: calculate subtotal, tax, discount, total
  orderBtn.addEventListener("click", function () {
    let subtotal = 0;

    document.querySelectorAll(".cart-item").forEach((item) => {
      const price = parseFloat(item.dataset.price);
      const qty = parseInt(item.querySelector(".quantity-input").value);
      subtotal += price * qty;
    });

    const tax = subtotal * 0.08; // 8% tax
    const discount = subtotal > 100 ? 15 : 0; // $15 discount if subtotal > $100
    const total = subtotal + tax - discount;

    document.getElementById("subtotal").textContent = `$${subtotal.toFixed(2)}`;
    document.getElementById("tax").textContent = `$${tax.toFixed(2)}`;
    document.getElementById("discount").textContent = `-$${discount.toFixed(2)}`;
    document.getElementById("grand-total").textContent = `$${total.toFixed(2)}`;
  });
});
</script>

{% endblock %}
